# C Project

Проект на языке C с базовой структурой и системой сборки.

## Структура проекта

```
.
├── main.c          # Основной файл программы
├── src/            # Исходные файлы
├── include/        # Заголовочные файлы
├── obj/            # Объектные файлы (создается автоматически)
├── bin/            # Исполняемые файлы (создается автоматически)
├── tests/          # Тесты
├── sum-server.c    # Сервер суммирования (родительский процесс)
├── sum-client.c    # Клиент суммирования (дочерний процесс)
└── Makefile        # Система сборки
```

## Быстрый старт

### Установка зависимостей
```bash
make install-deps
```

### Сборка проекта
```bash
make
```
Команда соберёт:
- bin/main — демонстрационный бинарь
- bin/sum-server и bin/sum-client — решение задания
- Также будут собраны исполняемые файлы для *.c из корня, если они есть

### Запуск основной программы
```bash
make run
```

### Очистка
```bash
make clean
```

### Отладочная сборка
```bash
make debug
```

## Сервер суммирования (sum-server/sum-client)

Задание реализовано двумя программами:
- sum-server — родительский процесс. Создаёт каналы (pipe), форкает и запускает клиента, проксирует ввод пользователя в stdin клиента.
- sum-client — дочерний процесс. Читает строки с целыми числами из stdin, считает сумму чисел в строке и записывает результат в указанный файл.

Ограничения выполнения задания:
- Используются системные вызовы POSIX (open/read/write/close/fork/exec/pipe/dup2/waitpid).
- stdio.h не требуется для работы серверной части; форматирование строк в клиенте не используется.

### Как запустить сервер

1) Соберите проект:
```bash
make
```

2) Запустите сервер:
```bash
./bin/sum-server
```

3) Введите в первую строку имя выходного файла, куда клиент будет писать суммы. Например:
```
out.txt
```

4) Затем вводите строки команд: каждая строка — это произвольное количество целых чисел (int) через пробел. Пример:
```
1 2 3
10 -5 7
```

5) Чтобы завершить работу, отправьте пустую строку (нажмите Enter на пустой строке) или EOF (Ctrl-D в Linux). После этого сервер дождётся завершения клиента и выйдет.

Итог: в указанном файле появятся суммы по одной на строку. Для примера выше файл out.txt будет содержать:
```
6
12
```

### Примеры запуска

- Интерактивно:
```bash
./bin/sum-server
# дальше введите:
# out.txt
# 1 2 3
# 10 -5 7
# <пустая строка для завершения>
```

- Непосредственно из конвейера:
```bash
echo -e "out.txt\n1 2 3\n10 -5 7\n" | ./bin/sum-server
```

- Цель Make для удобства:
```bash
make run-sum
# затем вводите как в интерактивном примере (первая строка — имя файла)
```

### Формат ввода и поведение

- Первая строка: обязательна, это путь к выходному файлу.
- Каждая следующая строка: список целых чисел (десятичные, допускаются ведущие/междучисловые пробелы, возможны знаки +/-).
- Пустая строка завершает работу клиента и сервера.
- Каждая непустая строка генерирует одну строку в выходном файле — сумму чисел этой строки и перевод строки.
- Некорректные токены пропускаются (символы вне чисел). Числа за пределами диапазона long сигнализируются предупреждением в stderr и усекаются стандартной функцией strtol.

### Куда пишется результат

Клиент открывает файл, имя которого вы передали первой строкой серверу, и записывает туда суммы. Если файл существует, он будет перезаписан. Права файла: 0600 (только для текущего пользователя).

### Каналы связи

- pipe1 (parent → child) подключён к stdin клиента (dup2). Сервер копирует ваш ввод в этот pipe.
- pipe2 (child → parent) подключён к stdout клиента. В текущей версии клиент пишет результаты непосредственно в файл, поэтому этот канал обычно пуст, но сервер на всякий случай считывает и выводит его содержимое на stdout.

### Диагностика и ошибки

- error: expected output filename on first line — вы не передали имя файла первой строкой.
- error: failed to create pipes / fork / exec — системная ошибка при создании каналов/процесса/запуске клиента.
- warning: input line too long, truncating — строка ввода длиннее внутреннего буфера, она будет обрезана.
- warning: integer out of range, clamped — число не влезает в диапазон long; strtol сообщила ERANGE, сумма считается с таким значением.

### Частые вопросы

- Почему файл пуст? Убедитесь, что первая строка — это имя файла, а завершаете вы пустой строкой, чтобы клиент закрыл файл и сервер завершил работу.
- Где находятся бинарники? После сборки — в каталоге bin (bin/sum-server и bin/sum-client).
- Нужно ли запускать клиент вручную? Нет, его запускает сервер через execv.

## Инструменты разработки

Проект настроен для использования:
- GCC — компилятор C
- GDB — отладчик
- Valgrind — анализатор памяти
- Make — система сборки

## Стандарт кода

Проект использует стандарт C11 с включенными предупреждениями компилятора (-Wall -Wextra).
