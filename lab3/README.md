# Лабораторная работа 3: Суммирование с использованием shared memory и семафоров

## Описание

Эта лабораторная работа является переделкой первой лабораторной работы. Вместо использования каналов (pipes) для межпроцессного взаимодействия, используется разделяемая память (shared memory) и семафоры для синхронизации.

Программа состоит из двух частей:
- `sum-server-shm`: сервер, который читает имя выходного файла из stdin, затем читает данные из stdin и передаёт их в shared memory.
- `sum-client-shm`: клиент, который читает данные из shared memory, суммирует числа в каждой строке и записывает суммы в выходной файл.

## Сборка

В каталоге `lab3` выполните:

```bash
make
```

Это создаст два исполняемых файла:
- `sum-server-shm`
- `sum-client-shm`

## Запуск

Сервер запускается как:

```bash
./sum-server-shm
```

Затем вводится имя выходного файла (первая строка), после чего вводятся строки с числами. Пустая строка завершает ввод.

Пример:

```bash
./sum-server-shm
output.txt
1 2 3
4 5
6

```

В файле `output.txt` будут суммы: 6, 9, 6.

## Детали реализации

### Shared Memory

В этой лабораторной работе используется POSIX shared memory (именованный shared memory объект), который создаётся в оперативной памяти (обычно в `/dev/shm`), а не на диске в виде файла. Shared memory и memory mapping — это разные концепции: memory mapping обычно подразумевает отображение файла на диске в память процесса, в то время как shared memory — это выделенная область памяти, доступная нескольким процессам без привязки к файлу на диске.

- Имя объекта: `/sum_shm`
- Создание: `shm_open` с `O_CREAT`, `ftruncate` для размера, `mmap` для отображения.
- Структура: `shared_data_t` с буфером `buf[8192]`, длиной `len` и флагом `eof`.
- Сервер создаёт объект, клиент открывает и отображает его.

### Семафоры

- `/sum_data_ready`: сигнализирует, что данные готовы для чтения.
- `/sum_processed`: сигнализирует, что клиент обработал данные.

Сервер: пишет данные в shared memory, постит `data_ready`, ждёт `processed`.
Клиент: ждёт `data_ready`, читает данные, обрабатывает, постит `processed`.

### Синхронизация

- Для EOF: сервер устанавливает `eof=1` и постит `data_ready`.
- Клиент проверяет `eof` и завершается при пустой строке.

## Зависимости

- Linux с поддержкой POSIX shared memory и семафоров.
- Компилятор gcc с `-lrt` для librt.

## Очистка

```bash
make clean
```

Удаляет исполняемые файлы.
